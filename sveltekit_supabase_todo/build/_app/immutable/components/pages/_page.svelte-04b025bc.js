import{S as $,i as x,s as ee,k as v,a as L,q as K,l as g,m as k,c as S,r as q,h as b,n as m,p as P,b as R,D as n,I as B,u as be,B as Y,J as se,K as we,L as _e,w as le,x as ie,y as ne,M as j,N as ge,f as G,t as J,z as oe,o as ye,e as ve,O as Ee,d as ke,H as Ie,g as Ue}from"../../chunks/index-49ed38d8.js";import{p as Le}from"../../chunks/stores-a1cd6584.js";import{a as C}from"../../chunks/supabaseClient-b2c95310.js";function Se(s){let e;return{c(){e=v("div"),this.h()},l(t){e=g(t,"DIV",{class:!0,style:!0}),k(e).forEach(b),this.h()},h(){m(e,"class","avatar no-image"),P(e,"height",s[0]+"em"),P(e,"width",s[0]+"em")},m(t,a){R(t,e,a)},p(t,a){a&1&&P(e,"height",t[0]+"em"),a&1&&P(e,"width",t[0]+"em")},d(t){t&&b(e)}}}function De(s){let e,t,a;return{c(){e=v("img"),this.h()},l(r){e=g(r,"IMG",{src:!0,alt:!0,class:!0,style:!0}),this.h()},h(){_e(e.src,t=s[1])||m(e,"src",t),m(e,"alt",a=s[1]?"Avatar":"No image"),m(e,"class","avatar image"),P(e,"height",s[0]+"em"),P(e,"width",s[0]+"em")},m(r,i){R(r,e,i)},p(r,i){i&2&&!_e(e.src,t=r[1])&&m(e,"src",t),i&2&&a!==(a=r[1]?"Avatar":"No image")&&m(e,"alt",a),i&1&&P(e,"height",r[0]+"em"),i&1&&P(e,"width",r[0]+"em")},d(r){r&&b(e)}}}function Ne(s){let e,t,a,r,i=s[2]?"Uploading ...":"Upload",p,h,u,w,o;function _(c,f){return c[1]?De:Se}let d=_(s),l=d(s);return{c(){e=v("div"),l.c(),t=L(),a=v("div"),r=v("label"),p=K(i),h=L(),u=v("input"),this.h()},l(c){e=g(c,"DIV",{});var f=k(e);l.l(f),t=S(f),a=g(f,"DIV",{style:!0});var D=k(a);r=g(D,"LABEL",{class:!0,for:!0});var E=k(r);p=q(E,i),E.forEach(b),h=S(D),u=g(D,"INPUT",{style:!0,type:!0,id:!0,accept:!0}),D.forEach(b),f.forEach(b),this.h()},h(){m(r,"class","button primary block"),m(r,"for","single"),P(u,"visibility","hidden"),P(u,"position","absolute"),m(u,"type","file"),m(u,"id","single"),m(u,"accept","image/*"),u.disabled=s[2],P(a,"width",s[0]+"em")},m(c,f){R(c,e,f),l.m(e,null),n(e,t),n(e,a),n(a,r),n(r,p),n(a,h),n(a,u),w||(o=[B(u,"change",s[6]),B(u,"change",s[4])],w=!0)},p(c,[f]){d===(d=_(c))&&l?l.p(c,f):(l.d(1),l=d(c),l&&(l.c(),l.m(e,t))),f&4&&i!==(i=c[2]?"Uploading ...":"Upload")&&be(p,i),f&4&&(u.disabled=c[2]),f&1&&P(a,"width",c[0]+"em")},i:Y,o:Y,d(c){c&&b(e),l.d(),w=!1,se(o)}}}function Pe(s,e,t){let{size:a=10}=e,{url:r}=e,i=null,p=!1,h;const u=we(),w=async d=>{try{const{data:l,error:c}=await C.storage.from("avatars").download(d);if(c)throw c;const f=URL.createObjectURL(l);t(1,i=f)}catch(l){l instanceof Error&&console.log("Error downloading image: ",l.message)}},o=async()=>{try{if(t(2,p=!0),!h||h.length===0)throw new Error("You must select an image to upload.");const d=h[0],l=d.name.split(".").pop(),c=`${Math.random()}.${l}`;let{error:f}=await C.storage.from("avatars").upload(c,d);if(f)throw f;t(5,r=c),console.log("url",r),u("upload")}catch(d){d instanceof Error&&alert(d.message)}finally{t(2,p=!1)}};function _(){h=this.files,t(3,h)}return s.$$set=d=>{"size"in d&&t(0,a=d.size),"url"in d&&t(5,r=d.url)},s.$$.update=()=>{s.$$.dirty&32&&r&&w(r)},[a,i,p,h,o,r,_]}class Ae extends ${constructor(e){super(),x(this,e,Pe,Ne,ee,{size:0,url:5})}}function Ve(s){let e,t,a,r,i,p,h,u,w,o,_,d,l,c,f,D,E,U,N,F,A,W,T,V,Q,te,H,O,ae,M,re,ue;return t=new Ae({props:{url:s[4]}}),{c(){e=v("form"),le(t.$$.fragment),a=L(),r=v("div"),i=v("label"),p=K("Email"),h=L(),u=v("input"),o=L(),_=v("div"),d=v("label"),l=K("Name"),c=L(),f=v("input"),D=L(),E=v("div"),U=v("label"),N=K("Website"),F=L(),A=v("input"),W=L(),T=v("div"),V=v("input"),te=L(),H=v("div"),O=v("button"),ae=K("Sign Out"),this.h()},l(I){e=g(I,"FORM",{class:!0});var y=k(e);ie(t.$$.fragment,y),a=S(y),r=g(y,"DIV",{});var z=k(r);i=g(z,"LABEL",{for:!0});var ce=k(i);p=q(ce,"Email"),ce.forEach(b),h=S(z),u=g(z,"INPUT",{id:!0,type:!0}),z.forEach(b),o=S(y),_=g(y,"DIV",{});var X=k(_);d=g(X,"LABEL",{for:!0});var fe=k(d);l=q(fe,"Name"),fe.forEach(b),c=S(X),f=g(X,"INPUT",{id:!0,type:!0}),X.forEach(b),D=S(y),E=g(y,"DIV",{});var Z=k(E);U=g(Z,"LABEL",{for:!0});var de=k(U);N=q(de,"Website"),de.forEach(b),F=S(Z),A=g(Z,"INPUT",{id:!0,type:!0}),Z.forEach(b),W=S(y),T=g(y,"DIV",{});var me=k(T);V=g(me,"INPUT",{type:!0,class:!0}),me.forEach(b),te=S(y),H=g(y,"DIV",{});var pe=k(H);O=g(pe,"BUTTON",{class:!0});var he=k(O);ae=q(he,"Sign Out"),he.forEach(b),pe.forEach(b),y.forEach(b),this.h()},h(){m(i,"for","email"),m(u,"id","email"),m(u,"type","text"),u.value=w=s[0].user.email,u.disabled=!0,m(d,"for","username"),m(f,"id","username"),m(f,"type","text"),m(U,"for","website"),m(A,"id","website"),m(A,"type","website"),m(V,"type","submit"),m(V,"class","button block primary"),V.value=Q=s[1]?"Loading...":"Update",V.disabled=s[1],m(O,"class","button block"),O.disabled=s[1],m(e,"class","form-widget")},m(I,y){R(I,e,y),ne(t,e,null),n(e,a),n(e,r),n(r,i),n(i,p),n(r,h),n(r,u),n(e,o),n(e,_),n(_,d),n(d,l),n(_,c),n(_,f),j(f,s[2]),n(e,D),n(e,E),n(E,U),n(U,N),n(E,F),n(E,A),j(A,s[3]),n(e,W),n(e,T),n(T,V),n(e,te),n(e,H),n(H,O),n(O,ae),M=!0,re||(ue=[B(f,"input",s[7]),B(A,"input",s[8]),B(O,"click",s[6]),B(e,"submit",ge(s[5]))],re=!0)},p(I,[y]){const z={};y&16&&(z.url=I[4]),t.$set(z),(!M||y&1&&w!==(w=I[0].user.email)&&u.value!==w)&&(u.value=w),y&4&&f.value!==I[2]&&j(f,I[2]),y&8&&j(A,I[3]),(!M||y&2&&Q!==(Q=I[1]?"Loading...":"Update"))&&(V.value=Q),(!M||y&2)&&(V.disabled=I[1]),(!M||y&2)&&(O.disabled=I[1])},i(I){M||(G(t.$$.fragment,I),M=!0)},o(I){J(t.$$.fragment,I),M=!1},d(I){I&&b(e),oe(t),re=!1,se(ue)}}}function Oe(s,e,t){let{session:a}=e,r=!1,i=null,p=null,h=null;ye(()=>{u()});const u=async()=>{try{t(1,r=!0);const{user:l}=a,{data:c,error:f,status:D}=await C.from("profiles").select("username, website, avatar_url").eq("id",l.id).single();if(console.log("data",c),c&&(t(2,i=c.username),t(3,p=c.website),t(4,h=c.avatar_url)),f&&D!==406)throw f}catch(l){l instanceof Error&&alert(l.message)}finally{t(1,r=!1)}};async function w(){try{t(1,r=!0);const{user:l}=a;console.log("avatarUrl",h);const c={id:l.id,username:i,website:p,avatar_url:h,updated_at:new Date};let{error:f}=await C.from("profiles").upsert(c);if(f)throw f}catch(l){l instanceof Error&&alert(l.message)}finally{t(1,r=!1)}}async function o(){try{t(1,r=!0);let{error:l}=await C.auth.signOut();if(l)throw l}catch(l){l instanceof Error&&alert(l.message)}finally{t(1,r=!1)}}function _(){i=this.value,t(2,i)}function d(){p=this.value,t(3,p)}return s.$$set=l=>{"session"in l&&t(0,a=l.session)},[a,r,i,p,h,w,o,_,d]}class Te extends ${constructor(e){super(),x(this,e,Oe,Ve,ee,{session:0})}}function Me(s){let e,t,a,r,i,p,h,u,w,o,_,d,l,c,f,D;return{c(){e=v("form"),t=v("div"),a=v("h1"),r=K("Supabase + SvelteKit"),i=L(),p=v("p"),h=K("Sign in via magic link with your email below"),u=L(),w=v("div"),o=v("input"),_=L(),d=v("div"),l=v("input"),this.h()},l(E){e=g(E,"FORM",{class:!0});var U=k(e);t=g(U,"DIV",{class:!0});var N=k(t);a=g(N,"H1",{class:!0});var F=k(a);r=q(F,"Supabase + SvelteKit"),F.forEach(b),i=S(N),p=g(N,"P",{class:!0});var A=k(p);h=q(A,"Sign in via magic link with your email below"),A.forEach(b),u=S(N),w=g(N,"DIV",{});var W=k(w);o=g(W,"INPUT",{class:!0,type:!0,placeholder:!0}),W.forEach(b),_=S(N),d=g(N,"DIV",{});var T=k(d);l=g(T,"INPUT",{type:!0,class:!0}),T.forEach(b),N.forEach(b),U.forEach(b),this.h()},h(){m(a,"class","header"),m(p,"class","description"),m(o,"class","inputField"),m(o,"type","email"),m(o,"placeholder","Your email"),m(l,"type","submit"),m(l,"class","button block"),l.value=c=s[0]?"Loading":"Send magic link",l.disabled=s[0],m(t,"class","col-6 form-widget"),m(e,"class","row flex-center flex")},m(E,U){R(E,e,U),n(e,t),n(t,a),n(a,r),n(t,i),n(t,p),n(p,h),n(t,u),n(t,w),n(w,o),j(o,s[1]),n(t,_),n(t,d),n(d,l),f||(D=[B(o,"input",s[3]),B(e,"submit",ge(s[2]))],f=!0)},p(E,[U]){U&2&&o.value!==E[1]&&j(o,E[1]),U&1&&c!==(c=E[0]?"Loading":"Send magic link")&&(l.value=c),U&1&&(l.disabled=E[0])},i:Y,o:Y,d(E){E&&b(e),f=!1,se(D)}}}function Be(s,e,t){let a=!1,r;const i=async()=>{try{t(0,a=!0);const{error:h}=await C.auth.signInWithOtp({email:r});if(h)throw h;alert("Check your email for the login link!")}catch(h){h instanceof Error&&alert(h.message)}finally{t(0,a=!1)}};function p(){r=this.value,t(1,r)}return[a,r,i,p]}class ze extends ${constructor(e){super(),x(this,e,Be,Me,ee,{})}}function Ke(s){let e,t;return e=new Te({props:{session:s[0].data.session}}),{c(){le(e.$$.fragment)},l(a){ie(e.$$.fragment,a)},m(a,r){ne(e,a,r),t=!0},p(a,r){const i={};r&1&&(i.session=a[0].data.session),e.$set(i)},i(a){t||(G(e.$$.fragment,a),t=!0)},o(a){J(e.$$.fragment,a),t=!1},d(a){oe(e,a)}}}function qe(s){let e,t;return e=new ze({}),{c(){le(e.$$.fragment)},l(a){ie(e.$$.fragment,a)},m(a,r){ne(e,a,r),t=!0},p:Y,i(a){t||(G(e.$$.fragment,a),t=!0)},o(a){J(e.$$.fragment,a),t=!1},d(a){oe(e,a)}}}function Re(s){let e,t,a,r,i,p;const h=[qe,Ke],u=[];function w(o,_){return o[0].data.session?1:0}return a=w(s),r=u[a]=h[a](s),{c(){e=v("meta"),t=L(),r.c(),i=ve(),this.h()},l(o){const _=Ee("svelte-168c3vc",document.head);e=g(_,"META",{name:!0,content:!0}),_.forEach(b),t=S(o),r.l(o),i=ve(),this.h()},h(){document.title="Supabase + SvelteKit",m(e,"name","description"),m(e,"content","SvelteKit using supabase-js v2")},m(o,_){n(document.head,e),R(o,t,_),u[a].m(o,_),R(o,i,_),p=!0},p(o,[_]){let d=a;a=w(o),a===d?u[a].p(o,_):(Ue(),J(u[d],1,1,()=>{u[d]=null}),ke(),r=u[a],r?r.p(o,_):(r=u[a]=h[a](o),r.c()),G(r,1),r.m(i.parentNode,i))},i(o){p||(G(r),p=!0)},o(o){J(r),p=!1},d(o){b(e),o&&b(t),u[a].d(o),o&&b(i)}}}function Fe(s,e,t){let a;return Ie(s,Le,r=>t(0,a=r)),[a]}class He extends ${constructor(e){super(),x(this,e,Fe,Re,ee,{})}}export{He as default};
